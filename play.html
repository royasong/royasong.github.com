<!DOCTYPE html>
<html>
<body>

<button onclick="start1()">START MEDIA SESSION</button>

<script>

let audio;

function start() {
    audio = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3");
    audio.loop = true;

    audio.play().then(() => {
        console.log("playing");

        if ('mediaSession' in navigator) {

            navigator.mediaSession.metadata = new MediaMetadata({
                title: "Observer Test Title",
                artist: "Observer Artist",
                album: "Observer Album"
            });

            navigator.mediaSession.playbackState = "playing";

            navigator.mediaSession.setActionHandler('play', () => audio.play());
            navigator.mediaSession.setActionHandler('pause', () => audio.pause());
            navigator.mediaSession.setActionHandler('stop', () => audio.pause());

            console.log("metadata + handlers set");
        }

    }).catch(e => {
        console.log("play failed:", e);
    });
}

</script>

</body>
</html>
